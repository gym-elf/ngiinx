# Local Build Pipeline for Nginx (Docker + Bash)

Данный проект реализует локальный конвейер сборки проекта.

Объект сборки: nginx (C)
Среда сборки: Docker-контейнер, собираемый автоматически внутри конвейера.
Языки реализации: bash

Поддерживаются три режима сборки:

* release — оптимизированная сборка с удалением отладочной информации
* debug — сборка с отладочными символами
* coverage — сборка с инструментами gcov/lcov и контролем динамики покрытия

---
### Модель конвейера

1. Проверка наличия Docker-образа для сборки:

   * Если образ существует — используется для запуска контейнера
   * Если образ отсутствует — автоматически собирается из Dockerfile

2. Поддержка трёх режимов сборки:

#### Release

* Сборка с оптимизациями -O2
* Выполняется strip бинарного файла
* Генерируется .deb пакет с номером ревизии

#### Debug

* Сборка с флагами -O0 -g
* В бинарный файл включена отладочная информация
* Генерируется .deb пакет с номером ревизии

#### Coverage

* Сборка с флагами --coverage
* Запускается интеграционный тест:

```
./objs/nginx -v
```
* Снимается покрытие с помощью lcov / genhtml
* Процент покрытия сравнивается с предыдущим запуском.


3. История сборок

При каждом запуске создаётся файл:

```
build_report_<date>_<mode>.txt
```
В котором фиксируются:

* номер запуска
* номер ревизии
* тип сборки
* значение покрытия (для coverage)

Номер ревизии автоматически увеличивается и добавляется ко всем артефактам.

---

## Требования

На хост-системе должны быть установлены:

* Docker
* bash
* git

Проект тестировался на Ubuntu 22.04 / WSL2.

---

## Запуск конвейера

Основной скрипт:

```
./scripts/build.sh <mode>
```

Где <mode>:

* release
* debug
* coverage
